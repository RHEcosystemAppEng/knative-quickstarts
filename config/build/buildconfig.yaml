apiVersion: template.openshift.io/v1
kind: Template
metadata:
  name: knative-demo-buildconfig
objects:
- apiVersion: v1
  kind: ImageStream
  metadata:
    name: producer-quarkus
    namespace: ${IMAGE_NAMESPACE}
- apiVersion: v1
  kind: ImageStream
  metadata:
    name: dispatcher-quarkus
    namespace: ${IMAGE_NAMESPACE}
- apiVersion: v1
  kind: ImageStream
  metadata:
    name: loader-quarkus
    namespace: ${IMAGE_NAMESPACE}
- apiVersion: build.openshift.io/v1
  kind: BuildConfig
  metadata:
    name: producer-quarkus
    namespace: ${IMAGE_NAMESPACE}
  spec:
    output:
      to:
        kind: ImageStreamTag
        name: producer-quarkus:latest
        namespace: ${IMAGE_NAMESPACE}
    postCommit: {}
    source:
      git:
        uri: https://github.com/RHEcosystemAppEng/knative-quickstarts.git
        ref: quarkus-eventing-demo
      contextDir: src/producer
      type: Git
    strategy:
      type: Source
      sourceStrategy:
        from:
          kind: DockerImage
          name: ubi8/openjdk-11:latest
    triggers:
      - type: ConfigChange
- apiVersion: build.openshift.io/v1
  kind: BuildConfig
  metadata:
    name: dispatcher-quarkus
    namespace: ${IMAGE_NAMESPACE}
  spec:
    output:
      to:
        kind: ImageStreamTag
        name: dispatcher-quarkus:latest
        namespace: ${IMAGE_NAMESPACE}
    postCommit: {}
    source:
      git:
        uri: https://github.com/RHEcosystemAppEng/knative-quickstarts.git
        ref: quarkus-eventing-demo
      contextDir: src/dispatcher
      type: Git
    strategy:
      type: Source
      sourceStrategy:
        from:
          kind: DockerImage
          name: ubi8/openjdk-11:latest
    triggers:
      - type: ConfigChange
- apiVersion: build.openshift.io/v1
  kind: BuildConfig
  metadata:
    name: loader-quarkus
    namespace: ${IMAGE_NAMESPACE}
  spec:
    output:
      to:
        kind: ImageStreamTag
        name: loader-quarkus:latest
        namespace: ${IMAGE_NAMESPACE}
    postCommit: {}
    source:
      git:
        uri: https://github.com/RHEcosystemAppEng/knative-quickstarts.git
        ref: quarkus-eventing-demo
      contextDir: src/loader
      type: Git
    strategy:
      type: Source
      sourceStrategy:
        from:
          kind: DockerImage
          name: ubi8/openjdk-11:latest
    triggers:
    - type: ConfigChange
parameters:
- description: Image namespace
  from: '[A-Z0-9]{8}'
  generate: expression
  name: IMAGE_NAMESPACE
labels:
  app: demo
  module: build